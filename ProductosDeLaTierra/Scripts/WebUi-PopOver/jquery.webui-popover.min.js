(function(n,t,i){"use strict";function s(t,i){this.$element=n(t);i&&(n.type(i.delay)==="string"||n.type(i.delay)==="number")&&(i.delay={show:i.delay,hide:i.delay});this.options=n.extend({},l,i);this._defaults=l;this._name=e;this._targetclick=!1;this.init();f.push(this.$element)}var e="webuiPopover",u="webui-popover",o="webui.popover",l={placement:"auto",width:"auto",height:"auto",trigger:"click",style:"",delay:{show:null,hide:null},async:{before:null,success:null},cache:!0,multi:!1,arrow:!0,title:"",content:"",closeable:!1,padding:!0,url:"",type:"html",animation:null,template:'<div class="webui-popover"><div class="arrow"><\/div><div class="webui-popover-inner"><a href="#" class="close">&times;<\/a><h3 class="webui-popover-title"><\/h3><div class="webui-popover-content"><i class="icon-refresh"><\/i> <p>&nbsp;<\/p><\/div><\/div><\/div>',backdrop:!1,dismissible:!0,onShow:null,onHide:null,abortXHR:!0,autoHide:!1,offsetTop:0,offsetLeft:0},f=[],h=n('<div class="webui-popover-backdrop"><\/div>'),a=0,v=!1,r=-2e3,c=n(i),y=function(n,t){return isNaN(n)?t||0:Number(n)},w=function(n){return n.data("plugin_"+e)},p=function(){for(var n=0;n<f.length;n++)f[n].webuiPopover("hide");c.trigger("hiddenAll."+o)},b=function(n){var t={x:0,y:0},i;return n.type==="touchstart"||n.type==="touchmove"||n.type==="touchend"||n.type==="touchcancel"?(i=n.originalEvent.touches[0]||n.originalEvent.changedTouches[0],t.x=i.pageX,t.y=i.pageY):(n.type==="mousedown"||n.type==="mouseup"||n.type==="click")&&(t.x=n.pageX,t.y=n.pageY),t};s.prototype={init:function(){if(this.getTrigger()==="click")this.$element.off("click touchend").on("click touchend",n.proxy(this.toggle,this));else if(this.getTrigger()==="hover")this.$element.off("mouseenter mouseleave click").on("mouseenter",n.proxy(this.mouseenterHandler,this)).on("mouseleave",n.proxy(this.mouseleaveHandler,this));this._poped=!1;this._inited=!0;this._opened=!1;this._idSeed=a;this.options.backdrop&&h.appendTo(i.body).hide();a++;this.getTrigger()==="sticky"&&this.show()},destroy:function(){for(var t=-1,n=0;n<f.length;n++)if(f[n]===this.$element){t=n;break}f.splice(t,1);this.hide();this.$element.data("plugin_"+e,null);this.getTrigger()==="click"?this.$element.off("click"):this.getTrigger()==="hover"&&this.$element.off("mouseenter mouseleave");this.$target&&this.$target.remove()},hide:function(t,i){var r,u;if((t||this.getTrigger()!=="sticky")&&this._opened&&(i&&(i.preventDefault(),i.stopPropagation()),this.xhr&&this.options.abortXHR===!0&&(this.xhr.abort(),this.xhr=null),r=n.Event("hide."+o),this.$element.trigger(r,[this.$target]),this.$target&&(this.$target.removeClass("in").addClass(this.getHideAnimation()),u=this,setTimeout(function(){u.$target.hide()},300)),this.options.backdrop&&h.hide(),this._opened=!1,this.$element.trigger("hidden."+o,[this.$target]),this.options.onHide))this.options.onHide(this.$target)},resetAutoHide:function(){var n=this,t=n.getAutoHide();t&&(n.autoHideHandler&&clearTimeout(n.autoHideHandler),n.autoHideHandler=setTimeout(function(){n.hide()},t))},toggle:function(n){n&&(n.preventDefault(),n.stopPropagation());this[this.getTarget().hasClass("in")?"hide":"show"]()},hideAll:function(){p()},show:function(){var n=this.getTarget().removeClass().addClass(u).addClass(this._customTargetClass);if(this.options.multi||this.hideAll(),!this._opened){if(this.getCache()&&this._poped&&this.content!==""||(this.content="",this.setTitle(this.getTitle()),this.options.closeable||n.find(".close").off("click").remove(),this.isAsync()?this.setContentASync(this.options.content):this.setContent(this.getContent()),n.show()),this.displayContent(),this.options.onShow)this.options.onShow(n);this.bindBodyEvents();this.options.backdrop&&h.show();this._opened=!0;this.resetAutoHide()}},displayContent:function(){var l=this.getElementPosition(),t=this.getTarget().removeClass().addClass(u).addClass(this._customTargetClass),s=this.getContentElement(),a=t[0].offsetWidth,v=t[0].offsetHeight,h="bottom",y=n.Event("show."+o),f,c,e;this.$element.trigger(y,[t]);this.options.width!=="auto"&&t.width(this.options.width);this.options.height!=="auto"&&s.height(this.options.height);this.options.style&&this.$target.addClass(u+"-"+this.options.style);this.options.arrow||t.find(".arrow").remove();t.detach().css({top:r,left:r,display:"block"});this.getAnimation()&&t.addClass(this.getAnimation());t.appendTo(i.body);h=this.getPlacement(l);this.$element.trigger("added."+o);this.initTargetEvents();this.options.padding||(this.options.height!=="auto"&&s.css("height",s.outerHeight()),this.$target.addClass("webui-no-padding"));a=t[0].offsetWidth;v=t[0].offsetHeight;f=this.getTargetPositin(l,h,a,v);this.$target.css(f.position).addClass(h).addClass("in");this.options.type==="iframe"&&(c=t.find("iframe"),c.width(t.width()).height(c.parent().height()));this.options.arrow||this.$target.css({margin:0});this.options.arrow&&(e=this.$target.find(".arrow"),e.removeAttr("style"),f.arrowOffset&&(f.arrowOffset.left===-1||f.arrowOffset.top===-1?e.hide():e.css(f.arrowOffset)));this._poped=!0;this.$element.trigger("shown."+o,[this.$target])},isTargetLoaded:function(){return this.getTarget().find("i.glyphicon-refresh").length===0},getTriggerElement:function(){return this.$element},getTarget:function(){if(!this.$target){var t=e+this._idSeed;this.$target=n(this.options.template).attr("id",t).data("trigger-element",this.getTriggerElement());this._customTargetClass=this.$target.attr("class")!==u?this.$target.attr("class"):null;this.getTriggerElement().attr("data-target",t)}return this.$target},getTitleElement:function(){return this.getTarget().find("."+u+"-title")},getContentElement:function(){return this.$contentElement||(this.$contentElement=this.getTarget().find("."+u+"-content")),this.$contentElement},getTitle:function(){return this.$element.attr("data-title")||this.options.title||this.$element.attr("title")},getUrl:function(){return this.$element.attr("data-url")||this.options.url},getAutoHide:function(){return this.$element.attr("data-auto-hide")||this.options.autoHide},getOffsetTop:function(){return y(this.$element.attr("data-offset-top"))||this.options.offsetTop},getOffsetLeft:function(){return y(this.$element.attr("data-offset-left"))||this.options.offsetLeft},getCache:function(){var n=this.$element.attr("data-cache");if(typeof n!="undefined")switch(n.toLowerCase()){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":return!1}return this.options.cache},getTrigger:function(){return this.$element.attr("data-trigger")||this.options.trigger},getDelayShow:function(){var n=this.$element.attr("data-delay-show");return typeof n!="undefined"?n:this.options.delay.show===0?0:this.options.delay.show||100},getHideDelay:function(){var n=this.$element.attr("data-delay-hide");return typeof n!="undefined"?n:this.options.delay.hide===0?0:this.options.delay.hide||100},getAnimation:function(){var n=this.$element.attr("data-animation");return n||this.options.animation},getHideAnimation:function(){var n=this.getAnimation();return n?n+"-out":"out"},setTitle:function(n){var t=this.getTitleElement();n?t.html(n):t.remove()},hasContent:function(){return this.getContent()},getContent:function(){var i,t;if(this.getUrl())switch(this.options.type){case"iframe":this.content=n('<iframe frameborder="0"><\/iframe>').attr("src",this.getUrl());break;case"html":try{this.content=n(this.getUrl());this.content.is(":visible")||this.content.show()}catch(r){throw new Error("Unable to get popover content. Invalid selector specified.");}}else this.content||(i="",i=n.isFunction(this.options.content)?this.options.content.apply(this.$element[0],[this]):this.options.content,this.content=this.$element.attr("data-content")||i,this.content||(t=this.$element.next(),t&&t.hasClass(u+"-content")&&(this.content=t)));return this.content},setContent:function(n){var i=this.getTarget(),t=this.getContentElement();typeof n=="string"?t.html(n):n instanceof jQuery&&(n.removeClass(u+"-content"),t.html(""),n.appendTo(t));this.$target=i},isAsync:function(){return this.options.type==="async"},setContentASync:function(t){var i=this;this.xhr||(this.xhr=n.ajax({url:this.getUrl(),type:"GET",cache:this.getCache(),beforeSend:function(n){i.options.async.before&&i.options.async.before(i,n)},success:function(r){i.bindBodyEvents();i.content=t&&n.isFunction(t)?t.apply(i.$element[0],[r]):r;i.setContent(i.content);var u=i.getContentElement();u.removeAttr("style");i.displayContent();i.options.async.success&&i.options.async.success(i,r)},complete:function(){i.xhr=null}}))},bindBodyEvents:function(){if(this.options.dismissible&&this.getTrigger()==="click"&&!v){c.off("keyup.webui-popover").on("keyup.webui-popover",n.proxy(this.escapeHandler,this));c.off("click.webui-popover touchend.webui-popover").on("click.webui-popover touchend.webui-popover",n.proxy(this.bodyClickHandler,this))}},mouseenterHandler:function(){var n=this;n._timeout&&clearTimeout(n._timeout);n._enterTimeout=setTimeout(function(){n.getTarget().is(":visible")||n.show()},this.getDelayShow())},mouseleaveHandler:function(){var n=this;clearTimeout(n._enterTimeout);n._timeout=setTimeout(function(){n.hide()},this.getHideDelay())},escapeHandler:function(n){n.keyCode===27&&this.hideAll()},bodyClickHandler:function(n){var u,i,t;for(v=!0,u=!0,i=0;i<f.length;i++)if(t=w(f[i]),t._opened){var e=t.getTarget().offset().left,o=t.getTarget().offset().top,s=t.getTarget().offset().left+t.getTarget().width(),h=t.getTarget().offset().top+t.getTarget().height(),r=b(n),c=r.x>=e&&r.x<=s&&r.y>=o&&r.y<=h;if(c){u=!1;break}}u&&p()},initTargetEvents:function(){if(this.getTrigger()==="hover")this.$target.off("mouseenter mouseleave").on("mouseenter",n.proxy(this.mouseenterHandler,this)).on("mouseleave",n.proxy(this.mouseleaveHandler,this));this.$target.find(".close").off("click").on("click",n.proxy(this.hide,this,!0))},getPlacement:function(n){var t,s=i.documentElement,c=i.body,f=s.clientWidth,r=s.clientHeight,l=Math.max(c.scrollTop,s.scrollTop),a=Math.max(c.scrollLeft,s.scrollLeft),e=Math.max(0,n.left-a),u=Math.max(0,n.top-l);t=typeof this.options.placement=="function"?this.options.placement.call(this,this.getTarget()[0],this.$element[0]):this.$element.data("placement")||this.options.placement;var o=t==="horizontal",h=t==="vertical",v=t==="auto"||o||h;return v?t=e<f/3?u<r/3?o?"right-bottom":"bottom-right":u<r*2/3?h?u<=r/2?"bottom-right":"top-right":"right":o?"right-top":"top-right":e<f*2/3?u<r/3?o?e<=f/2?"right-bottom":"left-bottom":"bottom":u<r*2/3?o?e<=f/2?"right":"left":u<=r/2?"bottom":"top":o?e<=f/2?"right-top":"left-top":"top":u<r/3?o?"left-bottom":"bottom-left":u<r*2/3?h?u<=r/2?"bottom-left":"top-left":"left":o?"left-top":"top-left":t==="auto-top"?t=e<f/3?"top-right":e<f*2/3?"top":"top-left":t==="auto-bottom"?t=e<f/3?"bottom-right":e<f*2/3?"bottom":"bottom-left":t==="auto-left"?t=u<r/3?"left-top":u<r*2/3?"left":"left-bottom":t==="auto-right"&&(t=u<r/3?"right-top":u<r*2/3?"right":"right-bottom"),t},getElementPosition:function(){return n.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTargetPositin:function(n,t,u,f){var e=n,p=i.documentElement,nt=i.body,tt=p.clientWidth,it=p.clientHeight,v=this.$element.outerWidth(),y=this.$element.outerHeight(),rt=Math.max(nt.scrollTop,p.scrollTop),ut=Math.max(nt.scrollLeft,p.scrollLeft),o={},l=null,w=this.options.arrow?20:0,s=10,h=v<w+s?w:0,c=y<w+s?w:0,a=0,ft=it+rt,et=tt+ut,b=e.left+e.width/2-h>0,k=e.left+e.width/2+h<et,d=e.top+e.height/2-c>0,g=e.top+e.height/2+c<ft;switch(t){case"bottom":o={top:e.top+e.height,left:e.left+e.width/2-u/2};break;case"top":o={top:e.top-f,left:e.left+e.width/2-u/2};break;case"left":o={top:e.top+e.height/2-f/2,left:e.left-u};break;case"right":o={top:e.top+e.height/2-f/2,left:e.left+e.width};break;case"top-right":o={top:e.top-f,left:b?e.left-h:s};l={left:b?Math.min(v,u)/2+h:r};break;case"top-left":a=k?h:-s;o={top:e.top-f,left:e.left-u+e.width+a};l={left:k?u-Math.min(v,u)/2-h:r};break;case"bottom-right":o={top:e.top+e.height,left:b?e.left-h:s};l={left:b?Math.min(v,u)/2+h:r};break;case"bottom-left":a=k?h:-s;o={top:e.top+e.height,left:e.left-u+e.width+a};l={left:k?u-Math.min(v,u)/2-h:r};break;case"right-top":a=g?c:-s;o={top:e.top-f+e.height+a,left:e.left+e.width};l={top:g?f-Math.min(y,f)/2-c:r};break;case"right-bottom":o={top:d?e.top-c:s,left:e.left+e.width};l={top:d?Math.min(y,f)/2+c:r};break;case"left-top":a=g?c:-s;o={top:e.top-f+e.height+a,left:e.left-u};l={top:g?f-Math.min(y,f)/2-c:r};break;case"left-bottom":o={top:d?e.top-c:s,left:e.left-u};l={top:d?Math.min(y,f)/2+c:r}}return o.top+=this.getOffsetTop(),o.left+=this.getOffsetLeft(),{position:o,arrowOffset:l}}};n.fn[e]=function(t,i){var r=[],u=this.each(function(){var u=n.data(this,"plugin_"+e);u?t==="destroy"?u.destroy():typeof t=="string"&&r.push(u[t]()):(t?typeof t=="string"?t!=="destroy"&&(i||(u=new s(this,null),r.push(u[t]()))):typeof t=="object"&&(u=new s(this,t)):u=new s(this,null),n.data(this,"plugin_"+e,u))});return r.length?r:u}})(jQuery,window,document);